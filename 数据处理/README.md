# 磁光克尔效应数据处理模块

本目录包含用于磁光克尔效应实验数据处理的Python脚本。每个脚本都有特定的功能，用于处理实验数据、进行校准、分析和可视化。

## 程序列表

### 1. `find_centre.py`

**功能**: 寻找磁滞回线的对称中心，用于数据对称化处理

**输入**: 
- CSV文件：`20251217/temp/test_findcentre.csv`（默认路径）
- 数据格式：第一列为磁场(mT)，第三列为克尔转角(deg)

**输出**:
- 控制台输出：最优对称中心y值
- 可视化图形：原始数据与对称变换后数据的对比图
- 函数返回值：`(x_data, y_data)` 原始数据数组

---

### 2. `hysteresis_calibration.py`

**功能**: 分析克尔转角中心值与起偏器额外转角的关系，进行线性校准

**输入**:
- JSON文件：`experiment_data.json`
- 数据内容：5个不同起偏器角度(0-4°)的克尔转角实验数据
- 硬编码参数：额外转角列表 `[0, 1, 2, 3, 4]` 度

**输出**:
- 文件输出：`calibration_curve.png`（校准曲线图）
- 控制台输出：详细的校准结果和线性拟合参数
- 函数返回值：`(slope, intercept, r_squared)` 拟合参数

---

### 3. `hysteresis_feature.py`

**功能**: 从磁滞回线数据中提取关键特征参数

**输入**:
- 磁滞回线数据文件：具体格式需查看代码
- 数据内容：磁场和克尔转角/椭率数据对

**输出**:
- 控制台输出：饱和磁化强度、矫顽力、剩磁、矩形比等特征参数
- 可视化图形：特征参数可视化
- 可能的数据文件输出：特征参数结果文件

---

### 4. `hysteresis_stat.py`

**功能**: 对多个磁滞回线进行统计分析

**输入**:
- 多个磁滞回线数据集文件
- 数据内容：多个实验的磁滞回线数据

**输出**:
- 控制台输出：统计参数（均值、标准差、变异系数）
- 可视化图形：统计图表
- 分析报告：数据分布分析结果

---

### 5. `kerr_relation.py`

**功能**: 分析克尔转角与克尔椭率之间的关系

**输入**:
- JSON文件：`experiment_data.json`
- 数据内容：包含"克尔转角"和"克尔椭率"两个键的数据
- 硬编码处理：实验4、5的克尔椭率中心值自动取负号

**输出**:
- 文件输出：`kerr_relation.png`（关系曲线图）
- 文件输出：`kerr_relation_data.txt`（关系数据文本）
- 控制台输出：统计分析结果和线性拟合参数
- 函数返回值：`(k, b, r_squared)` 拟合斜率、截距、R²

---

### 6. `manual_calibration.py`

**功能**: 提供交互式界面进行手动数据校准

**输入**:
- 原始实验数据文件
- 用户交互输入：校准参数（通过控制台输入）

**输出**:
- 控制台输出：校准后的数据
- 可视化图形：校准效果可视化
- 可能的文件输出：校准参数配置文件

---

### 7. `plot_improved_angle.py`

**功能**: 绘制经过改进处理的克尔转角数据

**输入**:
- JSON文件：`improved_angle_data.json`
- 数据内容：改进后的克尔转角数据数组

**输出**:
- 文件输出：`克尔转角_improved.png`（可视化图形）
- 文件输出：`克尔转角_improved_info.txt`（数据信息文本）
- 控制台输出：绘图状态信息

---

### 8. `plot_improved_ellipticity.py`

**功能**: 绘制经过改进处理的克尔椭率数据

**输入**:
- JSON文件：`improved_ellipticity_data.json`
- 数据内容：改进后的克尔椭率数据数组

**输出**:
- 文件输出：`克尔椭率_improved.png`（可视化图形）
- 文件输出：`ellipticity_info.txt`（数据信息文本）
- 控制台输出：绘图状态信息

---

### 9. `plot_modified_data.py`

**功能**: 绘制经过修正的原始数据

**输入**:
- 修正后的实验数据文件：具体格式需查看代码
- 数据内容：修正后的磁场和克尔转角/椭率数据

**输出**:
- 文件输出：`克尔转角_modified.png`和`克尔椭率_modified.png`（可视化图形）
- 文件输出：`modification_centres.txt`（修正中心数据）
- 控制台输出：修正处理报告

---

### 10. `read_data.py`

**功能**: 读取和处理原始实验数据文件

**输入**:
- 原始实验数据文件：`.dat`格式
- 具体文件：`20251217/0deg.dat`到`20251217/4deg.dat`（5个文件）
- 数据格式：文本格式的数值数据

**输出**:
- 函数返回值：处理后的数据数组
- 控制台输出：数据质量检查报告
- 可能的文件输出：处理后的数据文件

---

### 11. `read_data_symmetrized.py`

**功能**: 读取并对称化实验数据

**输入**:
- 原始实验数据文件：与`read_data.py`相同
- 函数依赖：`find_centre.py`中的对称化函数

**输出**:
- 函数返回值：对称化后的数据数组
- 控制台输出：对称化处理报告
- 可能的文件输出：对称化后的数据文件

---

### 12. `reflection_correction.py`

**功能**: 计算两个介质界面反射的偏振态变化（根据理论推导第6章）

**输入**:
- 命令行参数：`--visualize`（可选，直接运行可视化）
- 函数参数：`n`（相对折射率，n>1），`alpha`（入射光偏振角），`theta`（入射角）
- 用户交互输入：运行示例后询问是否运行可视化（y/n）
- 硬编码示例：5个预设的计算示例

**输出**:
- 控制台输出：详细的反射光偏振态分析结果
- 可视化图形：交互式可视化界面（包含滑动条控制）
- 函数返回值：`result`字典（包含所有计算结果的详细字典）

---

### 13. `test_fix.py`

**功能**: 测试数据修复和验证功能

**输入**:
- 测试数据文件：具体格式需查看代码
- 硬编码参数：测试用例和预期结果

**输出**:
- 控制台输出：测试结果报告（通过/失败）
- 可能的文件输出：测试日志文件

---

## 使用说明

### 数据处理流程
1. **数据定标验证**：使用`manual_calibration.py`读取定标数据，通过手工定标验证实验数据中使用的定标率正确性。

2. **定标关系验证**：使用`hysteresis_calibration.py`，通过磁滞回线数据验证定标关系的准确性。

3. **数据读取与预处理**：使用`read_data.py`读取原始实验数据。如需对称化处理，可调用`read_data_symmetrized.py`，该程序会生成相应的对称化数据。

4. **数据质量评估**：使用`plot_modified_data.py`初步观察原始数据的形状，分析数据质量和测量方向性。

5. **数据改进与饱和值分析**：使用`plot_improved_angle.py`和`plot_improved_ellipticity.py`绘制改进后的数据，并额外提取饱和值信息。

6. **磁滞特征提取**：使用`hysteresis_feature.py`获取饱和磁化强度和矫顽力等关键磁滞特征参数。

7. **克尔关系分析**：使用`kerr_relation.py`分析克尔转角与克尔椭率之间的相关性，验证反射镜产生额外转角的实验假说。

8. **统计影响探究**：使用`hysteresis_stat.py`深入探究克尔关系对磁滞特性的具体影响。

9. **理论辅助分析**：使用`reflection_correction.py`展示理论上反射镜的额外效应对偏振态的影响，作为辅助理解工具。

### 辅助程序说明
- `find_centre.py`：作为对称化处理的辅助计算模块，被其他程序调用，通常不需要单独运行。

### 依赖库
- numpy
- matplotlib
- pandas
- scipy (部分功能需要)

## 理论依据

本数据处理模块基于《理论推导.md》文档中的理论推导，特别是第6章"两个介质界面反射的偏振态分析"。所有计算都严格遵循菲涅尔公式和偏振光学原理。

## 注意事项

1. 所有角度单位默认为度，部分函数支持弧度
2. 数据文件路径可能需要根据实际情况调整
3. 可视化功能需要matplotlib库支持
4. 中文字体支持需要系统安装相应字体
5. 反射光偏振态计算要求相对折射率n>1
